{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pending Changes Review</title>
  <link rel="stylesheet" href="{% static 'css/bulma.0.9.4.min.css' %}" />
  <link rel="stylesheet" href="{% static 'css/main.css' %}" />
  <link rel="stylesheet" href="https://fi.wikipedia.org/w/load.php?modules=mediawiki.diff.styles&only=styles" />
</head>

<body>
  {% verbatim %}
  <div id="app" class="container is-fluid py-4">
    <section class="hero is-light">
      <div class="hero-body">
        <div class="columns is-vcentered">
          <div class="column is-4">
            <h1 class="title is-4">Pending Changes Review</h1>
          </div>
          <div class="column">
            <div class="field has-addons">
              <div class="control is-expanded">
                <div class="select is-fullwidth">
                  <select v-model.number="state.selectedWikiId" @change="loadPending">
                    <option disabled value="">Select wiki…</option>
                    <option v-for="wiki in state.wikis" :key="wiki.id" :value="wiki.id">
                      {{ wiki.name }} ({{ wiki.code }})
                    </option>
                  </select>
                </div>
              </div>
              <div class="control">
                <button class="button is-info" @click="refresh">Refresh</button>
              </div>
              <div class="control">
                <button class="button is-warning" @click="clearCache">Clear cache</button>
              </div>
            </div>
            <div class="field mt-3" v-if="currentWiki">
              <label class="label is-small">FlaggedRevs Quick Links:</label>
              <div class="buttons">
                <a :href="buildFlaggedRevsUrl('ValidationStatistics')" class="button is-small is-link is-light"
                  target="_blank" rel="noopener noreferrer">Validation Statistics</a>
                <a :href="buildFlaggedRevsUrl('PendingChanges')" class="button is-small is-link is-light"
                  target="_blank" rel="noopener noreferrer">Pending Changes</a>
                <a :href="buildFlaggedRevsUrl('Log/Review')" class="button is-small is-link is-light" target="_blank"
                  rel="noopener noreferrer">Review Log</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="section" v-if="currentWiki">
      <div class="box mb-5">
        <div class="level is-mobile">
          <div class="level-left">
            <div class="level-item">
              <h2 class="title is-4 mb-0">Configuration</h2>
            </div>
          </div>
          <div class="level-right">
            <div class="level-item">
              <button class="button is-small is-text" @click="toggleConfiguration">{{ state.configurationOpen ? 'Hide' :
                'Show' }}</button>
            </div>
          </div>
        </div>
        <div v-show="state.configurationOpen">
          <div class="columns">
            <div class="column">
              <label class="label">Blocking categories</label>
              <textarea class="textarea" rows="4" v-model="forms.blockingCategories"
                placeholder="One category per line"></textarea>
            </div>
            <div class="column">
              <label class="label">Auto-approved user groups</label>
              <textarea class="textarea" rows="4" v-model="forms.autoApprovedGroups"
                placeholder="One user group per line"></textarea>
            </div>
          </div>
          <div class="columns">
            <div class="column is-half">
              <label class="label">Revert Risk Threshold <span class="help">Set threshold (0.0-1.0) to block high-risk
                  edits. Leave empty to disable.</span></label>
              <input class="input" type="number" step="0.01" min="0" max="1" v-model="forms.revertriskThreshold"
                placeholder="e.g., 0.80 (leave empty to disable)" />
              <p class="help" v-if="forms.revertriskThreshold">Edits with {{ (parseFloat(forms.revertriskThreshold) *
                100).toFixed(0) }}% or higher revert probability will be blocked</p>
            </div>
          </div>
          <div class="content mt-4">
            <h3 class="title is-6">ORES Edit Quality Thresholds</h3>
            <p class="help">Set to 0 to disable checks. Values range from 0.0 to 1.0.</p>
          </div>
          <div class="columns">
            <div class="column">
              <div class="field">
                <label class="label">Damaging threshold</label>
                <input class="input" type="number" step="0.01" min="0" max="1"
                  v-model.number="forms.oresDamagingThreshold" placeholder="0.7">
                <p class="help">Edits with damaging probability above this will be blocked</p>
              </div>
              <div class="field mt-3">
                <label class="label">Goodfaith threshold</label>
                <input class="input" type="number" step="0.01" min="0" max="1"
                  v-model.number="forms.oresGoodfaithThreshold" placeholder="0.5">
                <p class="help">Edits with goodfaith probability below this will be blocked</p>
              </div>
            </div>
            <div class="column">
              <div class="field">
                <label class="label">Damaging threshold (Living persons)</label>
                <input class="input" type="number" step="0.01" min="0" max="1"
                  v-model.number="forms.oresDamagingThresholdLiving" placeholder="0.5">
                <p class="help">Stricter threshold for biographies of living persons</p>
              </div>
              <div class="field mt-3">
                <label class="label">Goodfaith threshold (Living persons)</label>
                <input class="input" type="number" step="0.01" min="0" max="1"
                  v-model.number="forms.oresGoodfaithThresholdLiving" placeholder="0.7">
                <p class="help">Stricter threshold for biographies of living persons</p>
              </div>
            </div>
          </div>
          <div class="buttons">
            <button class="button is-primary" @click="saveConfiguration">Save configuration</button>
          </div>
        </div>
      </div>
    </section>

    <div class="notification is-danger" v-if="state.error">{{ state.error }}</div>
    <div class="notification is-info" v-if="state.loading">Loading data…</div>

    <!-- The rest of the app markup (pages list, revisions, diffs etc.) is rendered by Vue in app.js -->
  </div>
  {% endverbatim %}

  {{ initial_wikis|json_script:"initial-wikis" }}
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="{% static 'reviews/app.js' %}"></script>
</body>

</html>